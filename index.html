<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <!-- Cache selama 2 hari 2 x 24 x 60 x 60 = 172800 -->
    <!-- 
    <meta http-equiv="Cache-Control" content="max-age=300"> 
    -->
    

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <script type="text/javascript">
        function filterBlocksByAddress(addressText) {
        console.log(addressText)
        //hide all options.
        document.querySelectorAll('#blockSelector option[name]').forEach(function(el) {
            el.classList.add("hidden")
        });
        //if not first one slected
        if (addressText != "KELURAHAN") {
            //loop through options where values matches..
            document.querySelectorAll('#blockSelector option[name=' + addressText + ']').forEach(function(el) {
            el.classList.remove("hidden"); //remove class
            })
        }
        document.getElementById('blockSelector').selectedIndex = 0 //set first vlau slected

        }        
    </script>
    
    <style>
        .hidden {
        display: none
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/@thumbmarkjs/thumbmarkjs/dist/thumbmark.umd.js"></script>
    <title>C HASIL</title>

  </head>
  <body>
  <h1 class="text-center">C HASIL</h1>
    <hr class="border border-primary border-2 opacity-50">
    <form class="container needs-validation" novalidate method="POST" id="formIsian" name="isianForm" action="">

      <div class="form-floating mb-3">
        <H4>DATA PENGAWAS TPS</H4>
        <input hidden type="text" id="visitorID" name="IDPengguna" value="">
        <input hidden type="text" id="tanggal" name="tanggal" value="">
        <input hidden type="text" id="lokasiPTPS" name="lokasiPTPS">
      </div>

      <div class="form-floating mb-3">
        <select required class="form-select" onchange="filterBlocksByAddress(this.options[this.selectedIndex].text)" aria-label="Default select example" id="KECAMATAN" name="KECAMATAN">
          <option selected disabled value="">PILIH KECAMATAN ANDA</option>
          <option value="BERBAH">BERBAH</option>
          <option value="CANGKRINGAN">CANGKRINGAN</option>
          <option value="DEPOK">DEPOK</option>
          <option value="GAMPING">GAMPING</option>
          <option value="GODEAN">GODEAN</option>
          <option value="KALASAN">KALASAN</option>
          <option value="MINGGIR">MINGGIR</option>
          <option value="MLATI">MLATI</option>
          <option value="MOYUDAN">MOYUDAN</option>
          <option value="NGAGLIK">NGAGLIK</option>
          <option value="NGEMPLAK">NGEMPLAK</option>
          <option value="PAKEM">PAKEM</option>
          <option value="PRAMBANAN">PRAMBANAN</option>
          <option value="SEYEGAN">SEYEGAN</option>
          <option value="SLEMAN">SLEMAN</option>
          <option value="TEMPEL">TEMPEL</option>
          <option value="TURI">TURI</option>
        </select>
        <label for="KECAMATAN">KECAMATAN</label>
        <div class="invalid-feedback">
            Pilih Kecamatan Anda!
        </div>
      </div>
      
      <div class="form-floating mb-3" >
        <select required id="blockSelector" class="form-select" aria-label="Default select example" name="KELURAHAN">
            <option selected disabled value="">PILIH KELURAHAN ANDA</option>
            <option class="hidden" name="BERBAH" value="SENDANGTIRTO">SENDANGTIRTO</option>
            <option class="hidden" name="BERBAH" value="TEGALTIRTO">TEGALTIRTO</option>
            <option class="hidden" name="BERBAH" value="KALITIRTO">KALITIRTO</option>
            <option class="hidden" name="BERBAH" value="JOGOTIRTO">JOGOTIRTO</option>
            <option class="hidden" name="CANGKRINGAN" value="ARGOMULYO">ARGOMULYO</option>
            <option class="hidden" name="CANGKRINGAN" value="WUKIRSARI">WUKIRSARI</option>
            <option class="hidden" name="CANGKRINGAN" value="GLAGAHARJO">GLAGAHARJO</option>
            <option class="hidden" name="CANGKRINGAN" value="KEPUHARJO">KEPUHARJO</option>
            <option class="hidden" name="CANGKRINGAN" value="UMBULHARJO">UMBULHARJO</option>
            <option class="hidden" name="DEPOK" value="CATURTUNGGAL">CATURTUNGGAL</option>
            <option class="hidden" name="DEPOK" value="MAGUWOHARJO">MAGUWOHARJO</option>
            <option class="hidden" name="DEPOK" value="CONDONGCATUR">CONDONGCATUR</option>
            <option class="hidden" name="GAMPING" value="BALECATUR">BALECATUR</option>
            <option class="hidden" name="GAMPING" value="AMBARKETAWANG">AMBARKETAWANG</option>
            <option class="hidden" name="GAMPING" value="BANYURADEN">BANYURADEN</option>
            <option class="hidden" name="GAMPING" value="NOGOTIRTO">NOGOTIRTO</option>
            <option class="hidden" name="GAMPING" value="TRIHANGGO">TRIHANGGO</option>
            <option class="hidden" name="GODEAN" value="SIDOREJO">SIDOREJO</option>
            <option class="hidden" name="GODEAN" value="SIDOLUHUR">SIDOLUHUR</option>
            <option class="hidden" name="GODEAN" value="SIDOMULYO">SIDOMULYO</option>
            <option class="hidden" name="GODEAN" value="SIDOAGUNG">SIDOAGUNG</option>
            <option class="hidden" name="GODEAN" value="SIDOKARTO">SIDOKARTO</option>
            <option class="hidden" name="GODEAN" value="SIDOARUM">SIDOARUM</option>
            <option class="hidden" name="GODEAN" value="SIDOMOYO">SIDOMOYO</option>
            <option class="hidden" name="KALASAN" value="PURWOMARTANI">PURWOMARTANI</option>
            <option class="hidden" name="KALASAN" value="TIRTOMARTANI">TIRTOMARTANI</option>
            <option class="hidden" name="KALASAN" value="TAMANMARTANI">TAMANMARTANI</option>
            <option class="hidden" name="KALASAN" value="SELOMARTANI">SELOMARTANI</option>
            <option class="hidden" name="MINGGIR" value="SENDANGARUM">SENDANGARUM</option>
            <option class="hidden" name="MINGGIR" value="SENDANGMULYO">SENDANGMULYO</option>
            <option class="hidden" name="MINGGIR" value="SENDANGAGUNG">SENDANGAGUNG</option>
            <option class="hidden" name="MINGGIR" value="SENDANGSARI">SENDANGSARI</option>
            <option class="hidden" name="MINGGIR" value="SENDANGREJO">SENDANGREJO</option>
            <option class="hidden" name="MLATI" value="SINDUADI">SINDUADI</option>
            <option class="hidden" name="MLATI" value="SENDANGADI">SENDANGADI</option>
            <option class="hidden" name="MLATI" value="TLOGOADI">TLOGOADI</option>
            <option class="hidden" name="MLATI" value="TIRTOADI">TIRTOADI</option>
            <option class="hidden" name="MLATI" value="SUMBERADI">SUMBERADI</option>
            <option class="hidden" name="MOYUDAN" value="SUMBERAHAYU">SUMBERAHAYU</option>
            <option class="hidden" name="MOYUDAN" value="SUMBERSARI">SUMBERSARI</option>
            <option class="hidden" name="MOYUDAN" value="SUMBERAGUNG">SUMBERAGUNG</option>
            <option class="hidden" name="MOYUDAN" value="SUMBERARUM">SUMBERARUM</option>
            <option class="hidden" name="NGAGLIK" value="SARIHARJO">SARIHARJO</option>
            <option class="hidden" name="NGAGLIK" value="MINOMARTANI">MINOMARTANI</option>
            <option class="hidden" name="NGAGLIK" value="SINDUHARJO">SINDUHARJO</option>
            <option class="hidden" name="NGAGLIK" value="SUKOHARJO">SUKOHARJO</option>
            <option class="hidden" name="NGAGLIK" value="SARDONOHARJO">SARDONOHARJO</option>
            <option class="hidden" name="NGAGLIK" value="DONOHARJO">DONOHARJO</option>
            <option class="hidden" name="NGEMPLAK" value="SINDUMARTANI">SINDUMARTANI</option>
            <option class="hidden" name="NGEMPLAK" value="BIMOMARTANI">BIMOMARTANI</option>
            <option class="hidden" name="NGEMPLAK" value="WIDODOMARTANI">WIDODOMARTANI</option>
            <option class="hidden" name="NGEMPLAK" value="WEDOMARTANI">WEDOMARTANI</option>
            <option class="hidden" name="NGEMPLAK" value="UMBULMARTANI">UMBULMARTANI</option>
            <option class="hidden" name="PAKEM" value="PURWOBINANGUN">PURWOBINANGUN</option>
            <option class="hidden" name="PAKEM" value="CANDIBINANGUN">CANDIBINANGUN</option>
            <option class="hidden" name="PAKEM" value="HARJOBINANGUN">HARJOBINANGUN</option>
            <option class="hidden" name="PAKEM" value="PAKEMBINANGUN">PAKEMBINANGUN</option>
            <option class="hidden" name="PAKEM" value="HARGOBINANGUN">HARGOBINANGUN</option>
            <option class="hidden" name="PRAMBANAN" value="SUMBERHARJO">SUMBERHARJO</option>
            <option class="hidden" name="PRAMBANAN" value="WUKIRHARJO">WUKIRHARJO</option>
            <option class="hidden" name="PRAMBANAN" value="GAYAMHARJO">GAYAMHARJO</option>
            <option class="hidden" name="PRAMBANAN" value="SAMBIREJO">SAMBIREJO</option>
            <option class="hidden" name="PRAMBANAN" value="MADUREJO">MADUREJO</option>
            <option class="hidden" name="PRAMBANAN" value="BOKOHARJO">BOKOHARJO</option>
            <option class="hidden" name="SEYEGAN" value="MARGOLUWIH">MARGOLUWIH</option>
            <option class="hidden" name="SEYEGAN" value="MARGODADI">MARGODADI</option>
            <option class="hidden" name="SEYEGAN" value="MARGOKATON">MARGOKATON</option>
            <option class="hidden" name="SEYEGAN" value="MARGOMULYO">MARGOMULYO</option>
            <option class="hidden" name="SEYEGAN" value="MARGOAGUNG">MARGOAGUNG</option>
            <option class="hidden" name="SLEMAN" value="CATURHARJO">CATURHARJO</option>
            <option class="hidden" name="SLEMAN" value="TRIHARJO">TRIHARJO</option>
            <option class="hidden" name="SLEMAN" value="TRIDADI">TRIDADI</option>
            <option class="hidden" name="SLEMAN" value="PANDOWOHARJO">PANDOWOHARJO</option>
            <option class="hidden" name="SLEMAN" value="TRIMULYO">TRIMULYO</option>
            <option class="hidden" name="TEMPEL" value="BANYUREJO">BANYUREJO</option>
            <option class="hidden" name="TEMPEL" value="TAMBAKREJO">TAMBAKREJO</option>
            <option class="hidden" name="TEMPEL" value="SUMBERREJO">SUMBERREJO</option>
            <option class="hidden" name="TEMPEL" value="PONDOKREJO">PONDOKREJO</option>
            <option class="hidden" name="TEMPEL" value="MOROREJO">MOROREJO</option>
            <option class="hidden" name="TEMPEL" value="MARGOREJO">MARGOREJO</option>
            <option class="hidden" name="TEMPEL" value="LUMBUNGREJO">LUMBUNGREJO</option>
            <option class="hidden" name="TEMPEL" value="MERDIKOREJO">MERDIKOREJO</option>
            <option class="hidden" name="TURI" value="BANGUNKERTO">BANGUNKERTO</option>
            <option class="hidden" name="TURI" value="DONOKERTO">DONOKERTO</option>
            <option class="hidden" name="TURI" value="GIRIKERTO">GIRIKERTO</option>
            <option class="hidden" name="TURI" value="WONOKERTO">WONOKERTO</option>
        </select>
        <label for="blockSelector">KELURAHAN</label>
        <div class="invalid-feedback">
            Pilih Kelurahan Anda!
        </div>
      </div>
      
      <div class="form-floating mb-3">
        <input required type="text" class="form-control" id="NAMAPENGAWASTPS" name="NAMA">
        <label for="NAMAPENGAWASTPS">NAMA PENGAWAS TPS</label>
        <div class="invalid-feedback">
            Isikan Nama Anda!
        </div>
      </div>
      <div class="form-floating mb-3">
        <input required type="number" min="0" step="1" data-bind="value:replyNumber" class="form-control" id="NOTPS" name="NOTPS">
        <label for="NOTPS">NOMOR TPS</label>
        <div class="invalid-feedback">
            Isikan nilainya!
        </div>
      </div>

      <hr class="border border-primary border-2 opacity-50">
      <div class="form-floating mb-3">
        <H4>IV. DATA RINCIAN PEROLEHAN SUARA SAH PASANGAN CALON BUPATI DAN WAKIL BUPATI</H4>
      </div>
      <div class="row">
        <div class="col">
          1. PASLON 1
        </div>
        <div class="col">
          <div class="form-floating mb-3">
            <input required type="number" min="0" step="1" data-bind="value:replyNumber" class="form-control" id="Paslon1" name="Paslon1">
            <label for="Paslon1">Jumlah</label>
            <div class="invalid-feedback">
                Isikan nilainya!
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col">
          2. PASLON 2
        </div>
        <div class="col">
          <div class="form-floating mb-3">
            <input required type="number" min="0" step="1" data-bind="value:replyNumber" class="form-control" id="Paslon2" name="Paslon2">
            <label for="Paslon2">Jumlah</label>
            <div class="invalid-feedback">
                Isikan nilainya!
            </div>
          </div>
        </div>
      </div>
      
      <div
        id="message"
        style="
            display: none;
            margin: 20px;
            font-weight: bold;
            color: green;
            padding: 8px;
            background-color: beige;
            border-radius: 4px;
            border-color: aquamarine;
        "
      ></div>
      <hr class="border border-primary border-2 opacity-50">
      <div class="form-floating mb-3">
        <H4>V. DATA SUARA TIDAK SAH</H4>
      </div>
      <div class="row">
        <div class="col">
          B. JUMLAH SUARA TIDAK SAH
        </div>
        <div class="col">
          <div class="form-floating mb-3">
            <input required type="number" min="0" step="1" data-bind="value:replyNumber" class="form-control" id="J_Semua_tidakSah" name="JUMLAH SUARA TIDAK SAH">
            <label for="J_Semua_tidakSah">Jumlah</label>
            <div class="invalid-feedback">
                Isikan nilainya!
            </div>
          </div>
        </div>
      </div>
      
      <div class="form-floating mb-3">
        <div class="d-grid gap-2">
            <button type="submit" id="submit" class="btn btn-primary">Submit</button>
        </div>
      </div>
    </form>


    <!-- Optional JavaScript; choose one of the two! -->
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

    <script type="text/javascript">
        // Example starter JavaScript for disabling form submissions if there are invalid fields
        (function () {
        'use strict'

        const scriptURL='https://script.google.com/macros/s/AKfycbxtnxhjCqHijxQSSBHdILoKt6lIu2IaBlp683utvWppRyhC-8acoU_npOhJag970tkRfA/exec';

        // Fetch all the forms we want to apply custom Bootstrap validation styles to
        var forms = document.querySelectorAll('.needs-validation')

        // Loop over them and prevent submission
        Array.prototype.slice.call(forms)
            .forEach(function (form) {
            form.addEventListener('submit', function (event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                    //alert("cek 1");
                } else {
                    //alert("cek 2");
                    event.preventDefault(); // Prevent the default form submission

                    document.getElementById("message").textContent = "Submitting..";
                    document.getElementById("message").style.display = "block";
                    document.getElementById("submit").disabled = true;

                    // Collect the form data
                    var formData = new FormData(this);
                    var keyValuePairs = [];
                    for (var pair of formData.entries()) {
                        keyValuePairs.push(pair[0] + "=" + pair[1]);
                    }

                    var formDataString = keyValuePairs.join("&");
        
                    // Send a POST request to your Google Apps Script
                    fetch(scriptURL,
                        {
                            redirect: "follow",
                            method: "POST",
                            body: formDataString,
                            headers: {
                            "Content-Type": "text/plain;charset=utf-8",
                            },
                        }
                    )
                    .then(function (response) {
                        // Check if the request was successful
                        if (response) {
                            return response; // Assuming your script returns JSON response
                        } else {
                            throw new Error("Failed to submit the form.");
                        }
                    })
                    .then(function (data) {
                        // Display a success message
                        document.getElementById("message").textContent =
                            "DATA BERHASIL DIKIRIM";
                        document.getElementById("message").style.display = "block";
                        document.getElementById("message").style.backgroundColor = "green";
                        document.getElementById("message").style.color = "beige";
                        document.getElementById("submit").disabled = true;
                        document.getElementById("formIsian").reset();

                        setTimeout(function () {
                            document.getElementById("message").textContent = "";
                            document.getElementById("message").style.display = "none";
                        }, 7200);

                        alert("DATA BERHASIL DIKIRIM");
                        //window.top.close();
                        window.close();
                    })
                    .catch(function (error) {
                    // Handle errors, you can display an error message here
                    console.error(error);
                    document.getElementById("message").textContent =
                        "ERROR SAAT MENGIRIMKAN DATA";
                    document.getElementById("message").style.display = "block";
                    document.getElementById("submit").disabled = false;
                    });

                }

                form.classList.add('was-validated')
            }, false)
            })
        })()

    </script>

    <script type="text/javascript">

        //ID uniq pengguna
        ThumbmarkJS.getFingerprint().then(
            function(fp) {
                console.log(fp);
                document.getElementById('visitorID').value= fp;
            }
        );

        //Waktu pengiriman DATA
        //var datetime = new Date().toLocaleString().slice(0,10) +" "+new Date(new Date()).toString().split(' ')[4];
        var objToday = new Date(),
            weekday = new Array('Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'),
            dayOfWeek = weekday[objToday.getDay()],
            domEnder = function() { var a = objToday; if (/1/.test(parseInt((a + "").charAt(0)))) return "th"; a = parseInt((a + "").charAt(1)); return 1 == a ? "st" : 2 == a ? "nd" : 3 == a ? "rd" : "th" }(),
            dayOfMonth = today + ( objToday.getDate() < 10) ? '0' + objToday.getDate() + domEnder : objToday.getDate() + domEnder,
            months = new Array('January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'),
            curMonth = months[objToday.getMonth()],
            curYear = objToday.getFullYear(),
            curHour = objToday.getHours() > 12 ? objToday.getHours() - 12 : (objToday.getHours() < 10 ? "0" + objToday.getHours() : objToday.getHours()),
            curMinute = objToday.getMinutes() < 10 ? "0" + objToday.getMinutes() : objToday.getMinutes(),
            curSeconds = objToday.getSeconds() < 10 ? "0" + objToday.getSeconds() : objToday.getSeconds(),
            dd = String(objToday.getDate()).padStart(2, '0'),
            mm = String(objToday.getMonth() + 1).padStart(2, '0'), //January is 0!
            yyyy = objToday.getFullYear(),
            //curMeridiem = objToday.getHours() > 12 ? "PM" : "AM";
            curMeridiem = objToday.getHours() > 11 ? "PM" : "AM";
            
        var today = dd + "/" + mm + "/" + yyyy + " " +  curHour + ":" + curMinute + "." + curSeconds + " " + curMeridiem ;
        console.log(today);
        document.getElementById('tanggal').value= today;

        navigator.geolocation.getCurrentPosition(function(location) {
            //console.log(location.coords.latitude);
            //console.log(location.coords.longitude);
            //console.log(location.coords.accuracy);
            document.getElementById('lokasiPTPS').value= location.coords.latitude + "," + location.coords.longitude;
        });

    </script>

    <script>
        // Fungsi untuk menyimpan data ke cache
        function saveToCache(url) {
            // Menyimpan URL dengan tanggal kadaluarsa (2 hari dari sekarang)
            const expirationDate = new Date();
            //expirationDate.setDate(expirationDate.getDate() + 2); // 2 hari dari sekarang
            expirationDate.setDate(expirationDate.getDate() + 1); // 1 hari dari sekarang

            // Menyimpan URL dan tanggal kadaluarsa ke localStorage
            localStorage.setItem('visited_url', url);
            localStorage.setItem('cache_expiration', expirationDate.toISOString());
        }

        // Fungsi untuk mengecek apakah URL sudah ada di cache
        function checkCache() {
            const cachedUrl = localStorage.getItem('visited_url');
            const expirationDate = new Date(localStorage.getItem('cache_expiration'));
            const currentDate = new Date();

            // Mengecek apakah cache sudah kadaluarsa
            if (cachedUrl && expirationDate > currentDate) {
                //console.log('Anda sudah mengakses URL ini sebelumnya:', cachedUrl);
                //alert('Anda sudah pernah mengakses URL ini!');

                // Jika pernah mengakses, matikan tombol
                document.getElementById("message").textContent =
                            "HANYA BOLEH SATU KALI INPUT";
                document.getElementById("submit").disabled = true;
                document.getElementById("KECAMATAN").disabled = true;
                document.getElementById("blockSelector").disabled = true;
                document.getElementById("NAMAPENGAWASTPS").disabled = true;
                document.getElementById("NOTPS").disabled = true;
                document.getElementById("Paslon1").disabled = true;
                document.getElementById("Paslon2").disabled = true;
                document.getElementById("J_Semua_tidakSah").disabled = true;
                alert("HANYA BOLEH SATU KALI INPUT");
                //window.close();
            } else {
                //console.log('Ini adalah pertama kali Anda mengakses URL ini.');
                //alert('Selamat datang, ini adalah pertama kali Anda mengakses URL ini!');
                // Simpan URL ke cache
                saveToCache('https://pilbupsleman2024.github.io/qcpilbup');
            }
        }

        // Fungsi untuk menghapus cache jika sudah kadaluarsa
        function clearCacheIfExpired() {
            const expirationDate = new Date(localStorage.getItem('cache_expiration'));
            const currentDate = new Date();

            // Cek apakah cache sudah kadaluarsa
            if (expirationDate && expirationDate < currentDate) {
                localStorage.removeItem('visited_url');
                localStorage.removeItem('cache_expiration');
                //console.log('Cache telah dihapus karena sudah kadaluarsa.');
                //alert('Cache telah dihapus karena sudah kadaluarsa!');
            }
        }

        // Fungsi untuk menghapus cache secara manual
        function clearCache() {
            localStorage.removeItem('visited_url');
            localStorage.removeItem('cache_expiration');
            console.log('Cache telah dihapus secara manual.');
            //alert('Cache telah dihapus secara manual!');
        }

        // Jalankan pengecekan cache saat halaman dimuat
        window.onload = function() {
            checkCache();
            clearCacheIfExpired();  // Cek dan hapus cache jika sudah kadaluarsa
        }
    </script>

    <!--
    <button onclick="clearCache()">.</button>
    -->
    <button type="button" onclick="clearCache()" class="btn" data-bs-toggle="button" style="--bs-btn-padding-y: .25rem; --bs-btn-padding-x: .5rem; --bs-btn-font-size: .75rem;">
        .
    </button>
        
  </body>
</html>